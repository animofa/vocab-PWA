        const vocabulary = [
{ front: "to set up, to arrange", back: "hat eingerichtet", lesson: "A2.9" },	{ front: "has set up, has arranged", back: "hat eingerichtet", lesson: "A2.9" },
{ front: "the poster", back: "die Poster", lesson: "A2.9" },	{ front: "the posters", back: "die Poster", lesson: "A2.9" },
{ front: "the candle", back: "die Kerzen", lesson: "A2.9" },	{ front: "the candles", back: "die Kerzen", lesson: "A2.9" },
{ front: "awful, hideous, horrible", back: "-", lesson: "A2.9" },	
{ front: "colorful, multicolored", back: "-", lesson: "A2.9" },	
{ front: "to look, to watch", back: "hat geguckt", lesson: "A2.9" },	{ front: "has looked, has watched", back: "hat geguckt", lesson: "A2.9" },
{ front: "the wallet, the purse", back: "die Brieftaschen", lesson: "A2.9" },	{ front: "the wallets, the purses", back: "die Brieftaschen", lesson: "A2.9" },
{ front: "the lighter", back: "die Feuerzeuge", lesson: "A2.9" },	{ front: "the lighters", back: "die Feuerzeuge", lesson: "A2.9" },
{ front: "the camera", back: "die Kameras", lesson: "A2.9" },	{ front: "the cameras", back: "die Kameras", lesson: "A2.9" },
{ front: "the bikini", back: "die Bikinis", lesson: "A2.9" },	{ front: "the bikinis", back: "die Bikinis", lesson: "A2.9" },
{ front: "practical", back: "-", lesson: "A2.9" },	
{ front: "pretty, lovely", back: "-", lesson: "A2.9" },	
{ front: "thick, fat", back: "-", lesson: "A2.9" },	
{ front: "the plate", back: "die Platten", lesson: "A2.9" },	{ front: "the plates", back: "die Platten", lesson: "A2.9" },
{ front: "the height", back: "die Höhen", lesson: "A2.9" },	{ front: "the heights", back: "die Höhen", lesson: "A2.9" },
{ front: "the condition, the state", back: "die Zustände", lesson: "A2.9" },	{ front: "the conditions, the states", back: "die Zustände", lesson: "A2.9" },
{ front: "the quality", back: "die Qualitäten", lesson: "A2.9" },	{ front: "the qualities", back: "die Qualitäten", lesson: "A2.9" },
{ front: "the cutlery", back: "die Bestecke", lesson: "A2.9" },	{ front: "the cutleries", back: "die Bestecke", lesson: "A2.9" },
{ front: "the metal", back: "die Metalle", lesson: "A2.9" },	{ front: "the metals", back: "die Metalle", lesson: "A2.9" },
{ front: "the fabric, the material", back: "die Stoffe", lesson: "A2.9" },	{ front: "the fabrics, the materials", back: "die Stoffe", lesson: "A2.9" },
{ front: "the backpack", back: "die Rucksäcke", lesson: "A2.9" },	{ front: "the backpacks", back: "die Rucksäcke", lesson: "A2.9" },
{ front: "the hat", back: "die Hüte", lesson: "A2.9" },	{ front: "the hats", back: "die Hüte", lesson: "A2.9" },
{ front: "the love", back: "-", lesson: "A2.9" },	
{ front: "the novel", back: "die Romane", lesson: "A2.9" },	{ front: "the novels", back: "die Romane", lesson: "A2.9" },
{ front: "exciting, thrilling", back: "-", lesson: "A2.9" },	
{ front: "than, as", back: "-", lesson: "A2.9" },	
{ front: "the stadium", back: "die Stadien", lesson: "A2.9" },	{ front: "the stadiums", back: "die Stadien", lesson: "A2.9" },
{ front: "the PC, the personal computer", back: "die PCs", lesson: "A2.9" },	{ front: "the PCs", back: "die PCs", lesson: "A2.9" },
{ front: "the pudding", back: "die Puddings", lesson: "A2.9" },	{ front: "the puddings", back: "die Puddings", lesson: "A2.9" },
{ front: "the shop window", back: "die Schaufenster", lesson: "A2.9" },	{ front: "the shop windows", back: "die Schaufenster", lesson: "A2.9" },
{ front: "to suggest", back: "hat vorgeschlagen", lesson: "A2.9" },	{ front: "has suggested", back: "hat vorgeschlagen", lesson: "A2.9" },
{ front: "distant, removed", back: "-", lesson: "A2.9" },	
{ front: "the statistics", back: "die Statistiken", lesson: "A2.9" },	{ front: "the statistics", back: "die Statistiken", lesson: "A2.9" },
{ front: "the foodstuff", back: "die Nahrungsmittel", lesson: "A2.9" },	{ front: "the foodstuffs", back: "die Nahrungsmittel", lesson: "A2.9" },
{ front: "the gas", back: "die Gase", lesson: "A2.9" },	{ front: "the gases", back: "die Gase", lesson: "A2.9" },
{ front: "the credit", back: "die Kredite", lesson: "A2.9" },	{ front: "the credits", back: "die Kredite", lesson: "A2.9" },
{ front: "to record, to admit, to take", back: "hat aufgenommen", lesson: "A2.9" },	{ front: "has recorded, has admitted", back: "hat aufgenommen", lesson: "A2.9" },
{ front: "to save", back: "hat gespart", lesson: "A2.9" },	{ front: "has saved", back: "hat gespart", lesson: "A2.9" },
{ front: "some, many", back: "-", lesson: "A2.9" },	
{ front: "the memory", back: "die Erinnerungen", lesson: "A2.9" },	{ front: "the memories", back: "die Erinnerungen", lesson: "A2.9" },
{ front: "the thought", back: "die Gedanken", lesson: "A2.9" },	{ front: "the thoughts", back: "die Gedanken", lesson: "A2.9" },
{ front: "valuable", back: "-", lesson: "A2.9" },	
{ front: "back then, at that time", back: "-", lesson: "A2.9" },	
{ front: "dear, sweet", back: "-", lesson: "A2.9" },	
{ front: "therefore, that's why", back: "-", lesson: "A2.9" },	
{ front: "inside, in there", back: "-", lesson: "A2.9" },	
{ front: "the hammer", back: "die Hämmer", lesson: "A2.9" },	{ front: "the hammers", back: "die Hämmer", lesson: "A2.9" },
{ front: "the wood", back: "die Hölzer", lesson: "A2.9" },	{ front: "the woods", back: "die Hölzer", lesson: "A2.9" },
{ front: "the lamp", back: "die Lampen", lesson: "A2.9" },	{ front: "the lamps", back: "die Lampen", lesson: "A2.9" },
{ front: "the glass", back: "die Gläser", lesson: "A2.9" },	{ front: "the glasses", back: "die Gläser", lesson: "A2.9" },
{ front: "the cutlery", back: "die Bestecke", lesson: "A2.9" },	{ front: "the cutleries", back: "die Bestecke", lesson: "A2.9" },
{ front: "the metal", back: "die Metalle", lesson: "A2.9" },	{ front: "the metals", back: "die Metalle", lesson: "A2.9" },
{ front: "the (salad) bowl", back: "die (Salat-) Schüsseln", lesson: "A2.9" },	{ front: "the (salad) bowls", back: "die (Salat-) Schüsseln", lesson: "A2.9" },
{ front: "the plastic", back: "-", lesson: "A2.9" },	
{ front: "the entrance ticket", back: "die Eintrittskarten", lesson: "A2.9" },	{ front: "the entrance tickets", back: "die Eintrittskarten", lesson: "A2.9" },
{ front: "the paper", back: "die Papiere", lesson: "A2.9" },	{ front: "the papers", back: "die Papiere", lesson: "A2.9" },
{ front: "the package", back: "die Pakete", lesson: "A2.10" },	{ front: "the packages", back: "die Pakete", lesson: "A2.10" },
{ front: "the envelope", back: "die Briefumschläge", lesson: "A2.10" },	{ front: "the envelopes", back: "die Briefumschläge", lesson: "A2.10" },
{ front: "the postcard", back: "die Postkarten", lesson: "A2.10" },	{ front: "the postcards", back: "die Postkarten", lesson: "A2.10" },
{ front: "the scissors", back: "die Scheren", lesson: "A2.10" },	{ front: "the scissors", back: "die Scheren", lesson: "A2.10" },
{ front: "to send, to dispatch", back: "hat verschickt", lesson: "A2.10" },	{ front: "has sent, has dispatched", back: "hat verschickt", lesson: "A2.10" },
{ front: "to send, to mail", back: "hat versendet", lesson: "A2.10" },	{ front: "has sent, has mailed", back: "hat versendet", lesson: "A2.10" },
{ front: "neat, orderly", back: "-", lesson: "A2.10" },	
{ front: "the shipment, the broadcast", back: "die Sendungen", lesson: "A2.10" },	{ front: "the shipments, the broadcasts", back: "die Sendungen", lesson: "A2.10" },
{ front: "to transport", back: "hat transportiert", lesson: "A2.10" },	{ front: "has transported", back: "hat transportiert", lesson: "A2.10" },
{ front: "hard", back: "-", lesson: "A2.10" },	
{ front: "to weigh", back: "hat gewogen", lesson: "A2.10" },	{ front: "has weighed", back: "hat gewogen", lesson: "A2.10" },
{ front: "to pack", back: "hat verpackt", lesson: "A2.10" },	{ front: "has packed", back: "hat verpackt", lesson: "A2.10" },
{ front: "the ship", back: "die Schiffe", lesson: "A2.10" },	{ front: "the ships", back: "die Schiffe", lesson: "A2.10" },
{ front: "the harvest", back: "die Ernten", lesson: "A2.10" },	{ front: "the harvests", back: "die Ernten", lesson: "A2.10" },
{ front: "ripe", back: "-", lesson: "A2.10" },	
{ front: "soft", back: "-", lesson: "A2.10" },	
{ front: "the imagination, the fantasy", back: "die Fantasien", lesson: "A2.10" },	{ front: "the imaginations, the fantasies", back: "die Fantasien", lesson: "A2.10" },
{ front: "what kind of, what a", back: "-", lesson: "A2.10" },	
{ front: "the possibility", back: "die Möglichkeiten", lesson: "A2.10" },	{ front: "the possibilities", back: "die Möglichkeiten", lesson: "A2.10" },
{ front: "then, actually, because", back: "-", lesson: "A2.10" },	
{ front: "the registered letter", back: "-", lesson: "A2.10" },	
{ front: "to send", back: "hat gesendet", lesson: "A2.10" },	{ front: "has sent", back: "hat gesendet", lesson: "A2.10" },
{ front: "the small package", back: "die Päckchen", lesson: "A2.10" },	{ front: "the small packages", back: "die Päckchen", lesson: "A2.10" },
{ front: "the customs", back: "die Zölle", lesson: "A2.10" },	{ front: "the customs", back: "die Zölle", lesson: "A2.10" },
{ front: "valuable, worth", back: "-", lesson: "A2.10" },	
{ front: "absolutely, necessarily", back: "-", lesson: "A2.10" },	
{ front: "the worry, the concern", back: "die Sorgen", lesson: "A2.10" },	{ front: "the worries, the concerns", back: "die Sorgen", lesson: "A2.10" },
{ front: "to freeze", back: "hat gefroren", lesson: "A2.10" },	{ front: "has frozen", back: "hat gefroren", lesson: "A2.10" },
{ front: "the railway", back: "die Eisenbahnen", lesson: "A2.10" },	{ front: "the railways", back: "die Eisenbahnen", lesson: "A2.10" },
{ front: "the leaf", back: "die Blätter", lesson: "A2.10" },	{ front: "the leaves", back: "die Blätter", lesson: "A2.10" },
{ front: "the bear", back: "die Bären", lesson: "A2.10" },	{ front: "the bears", back: "die Bären", lesson: "A2.10" },
{ front: "the coin", back: "die Münzen", lesson: "A2.10" },	{ front: "the coins", back: "die Münzen", lesson: "A2.10" },
{ front: "the duck", back: "die Enten", lesson: "A2.10" },	{ front: "the ducks", back: "die Enten", lesson: "A2.10" },
{ front: "the souvenir", back: "die Souvenirs", lesson: "A2.10" },	{ front: "the souvenirs", back: "die Souvenirs", lesson: "A2.10" },
{ front: "the animal", back: "die Tiere", lesson: "A2.10" },	{ front: "the animals", back: "die Tiere", lesson: "A2.10" },
{ front: "the bird", back: "die Vögel", lesson: "A2.10" },	{ front: "the birds", back: "die Vögel", lesson: "A2.10" },
{ front: "un-, not", back: "-", lesson: "A2.10" },	
{ front: "the point", back: "die Punkte", lesson: "A2.10" },	{ front: "the points", back: "die Punkte", lesson: "A2.10" },
{ front: "the elephant", back: "die Elefanten", lesson: "A2.10" },	{ front: "the elephants", back: "die Elefanten", lesson: "A2.10" },
{ front: "the rose", back: "die Rosen", lesson: "A2.10" },	{ front: "the roses", back: "die Rosen", lesson: "A2.10" },
{ front: "the star", back: "die Sterne", lesson: "A2.10" },	{ front: "the stars", back: "die Sterne", lesson: "A2.10" },
{ front: "the sky", back: "die Himmel", lesson: "A2.10" },	{ front: "the skies", back: "die Himmel", lesson: "A2.10" },
{ front: "orange", back: "-", lesson: "A2.10" },	
{ front: "the network", back: "die Netzwerke", lesson: "A2.10" },	{ front: "the networks", back: "die Netzwerke", lesson: "A2.10" },
{ front: "to test", back: "hat getestet", lesson: "A2.10" },	{ front: "has tested", back: "hat getestet", lesson: "A2.10" },
{ front: "the knowledge", back: "-", lesson: "A2.10" },	
{ front: "the quiz", back: "-", lesson: "A2.10" },	
{ front: "the mobile phone", back: "die Mobiltelefone", lesson: "A2.10" },	{ front: "the mobile phones", back: "die Mobiltelefone", lesson: "A2.10" },
{ front: "the mail, the email", back: "die Mails", lesson: "A2.10" },	{ front: "the mails", back: "die Mails", lesson: "A2.10" },
{ front: "worldwide", back: "-", lesson: "A2.10" },	
{ front: "the mailbox", back: "die Mailboxen", lesson: "A2.10" },	{ front: "the mailboxes", back: "die Mailboxen", lesson: "A2.10" },
{ front: "the success", back: "die Erfolge", lesson: "A2.10" },	{ front: "the successes", back: "die Erfolge", lesson: "A2.10" },
{ front: "the pub, the tavern", back: "die Kneipen", lesson: "A2.10" },	{ front: "the pubs, the taverns", back: "die Kneipen", lesson: "A2.10" },
{ front: "to report, to get in touch", back: "hat sich gemeldet", lesson: "A2.10" },	{ front: "has reported, has gotten in touch", back: "hat sich gemeldet", lesson: "A2.10" },
{ front: "the parent council", back: "die Elternbeiräte", lesson: "A2.10" },	{ front: "the parent councils", back: "die Elternbeiräte", lesson: "A2.10" },
{ front: "the flu", back: "-", lesson: "A2.10" },	
{ front: "the vaccination", back: "die Impfungen", lesson: "A2.10" },	{ front: "the vaccinations", back: "die Impfungen", lesson: "A2.10" },
{ front: "the consulate", back: "die Konsulate", lesson: "A2.10" },	{ front: "the consulates", back: "die Konsulate", lesson: "A2.10" },
{ front: "general", back: "-", lesson: "A2.10" },	
{ front: "the letter", back: "die Briefe", lesson: "A2.10" },	{ front: "the letters", back: "die Briefe", lesson: "A2.10" },
{ front: "the mailbox", back: "die Briefkästen", lesson: "A2.10" },	{ front: "the mailboxes", back: "die Briefkästen", lesson: "A2.10" },
{ front: "the email", back: "die E-Mails", lesson: "A2.10" },	{ front: "the emails", back: "die E-Mails", lesson: "A2.10" },
{ front: "the mobile phone", back: "die Handys", lesson: "A2.10" },	{ front: "the mobile phones", back: "die Handys", lesson: "A2.10" },
{ front: "the chat", back: "die Chats", lesson: "A2.10" },	{ front: "the chats", back: "die Chats", lesson: "A2.10" },
{ front: "the zoo", back: "die Zoos", lesson: "A2.11" },	{ front: "the zoos", back: "die Zoos", lesson: "A2.11" },
{ front: "the tiger", back: "die Tiger", lesson: "A2.11" },	{ front: "the tigers", back: "die Tiger", lesson: "A2.11" },
{ front: "the zebra", back: "die Zebras", lesson: "A2.11" },	{ front: "the zebras", back: "die Zebras", lesson: "A2.11" },
{ front: "to look at, to watch", back: "hat angeschaut", lesson: "A2.11" },	{ front: "has looked at, has watched", back: "hat angeschaut", lesson: "A2.11" },
{ front: "to leave, to depart", back: "ist weggefahren", lesson: "A2.11" },	{ front: "has left, has departed", back: "ist weggefahren", lesson: "A2.11" },
{ front: "to jump", back: "ist gesprungen", lesson: "A2.11" },	{ front: "has jumped", back: "ist gesprungen", lesson: "A2.11" },
{ front: "to refuel", back: "hat getankt", lesson: "A2.11" },	{ front: "has refueled", back: "hat getankt", lesson: "A2.11" },
{ front: "along", back: "-", lesson: "A2.11" },	
{ front: "past … at", back: "-", lesson: "A2.11" },	
{ front: "opposite, across from", back: "-", lesson: "A2.11" },	
{ front: "the direction", back: "die Richtungen", lesson: "A2.11" },	{ front: "the directions", back: "die Richtungen", lesson: "A2.11" },
{ front: "the river", back: "die Flüsse", lesson: "A2.11" },	{ front: "the rivers", back: "die Flüsse", lesson: "A2.11" },
{ front: "the intersection", back: "die Kreuzungen", lesson: "A2.11" },	{ front: "the intersections", back: "die Kreuzungen", lesson: "A2.11" },
{ front: "to turn (off)", back: "ist abgebogen", lesson: "A2.11" },	{ front: "has turned", back: "ist abgebogen", lesson: "A2.11" },
{ front: "the exit", back: "die Ausfahrten", lesson: "A2.11" },	{ front: "the exits", back: "die Ausfahrten", lesson: "A2.11" },
{ front: "the copier", back: "die Kopierer", lesson: "A2.11" },	{ front: "the copiers", back: "die Kopierer", lesson: "A2.11" },
{ front: "the cafeteria", back: "die Cafeterien", lesson: "A2.11" },	{ front: "the cafeterias", back: "die Cafeterien", lesson: "A2.11" },
{ front: "the traffic jam", back: "die Staus", lesson: "A2.11" },	{ front: "the traffic jams", back: "die Staus", lesson: "A2.11" },
{ front: "the sidewalk", back: "die Bürgersteige", lesson: "A2.11" },	{ front: "the sidewalks", back: "die Bürgersteige", lesson: "A2.11" },
{ front: "to fall, to tumble", back: "ist gestürzt", lesson: "A2.11" },	{ front: "has fallen", back: "ist gestürzt", lesson: "A2.11" },
{ front: "the cyclist", back: "die Radfahrer", lesson: "A2.11" },	{ front: "the cyclists", back: "die Radfahrer", lesson: "A2.11" },
{ front: "the knee", back: "die Knie", lesson: "A2.11" },	{ front: "the knees", back: "die Knie", lesson: "A2.11" },
{ front: "to stick, to glue", back: "hat geklebt", lesson: "A2.11" },	{ front: "has stuck, has glued", back: "hat geklebt", lesson: "A2.11" },
{ front: "the band-aid, plaster", back: "die Pflaster", lesson: "A2.11" },	{ front: "the band-aids, plasters", back: "die Pflaster", lesson: "A2.11" },
{ front: "the bike, the wheel", back: "die Räder", lesson: "A2.11" },	{ front: "the bikes, the wheels", back: "die Räder", lesson: "A2.11" },
{ front: "the darling, the favorite", back: "die Lieblinge", lesson: "A2.11" },	{ front: "the darlings, the favorites", back: "die Lieblinge", lesson: "A2.11" },
{ front: "to stop, to remain standing", back: "ist stehen geblieben", lesson: "A2.11" },	{ front: "has stopped, has remained standing", back: "ist stehen geblieben", lesson: "A2.11" },
{ front: "the gasoline, petrol", back: "-", lesson: "A2.11" },	
{ front: "the battery", back: "die Batterien", lesson: "A2.11" },	{ front: "the batteries", back: "die Batterien", lesson: "A2.11" },
{ front: "empty", back: "-", lesson: "A2.11" },	
{ front: "on time, punctual", back: "-", lesson: "A2.11" },	
{ front: "the traffic", back: "-", lesson: "A2.11" },	
{ front: "the construction site", back: "die Baustellen", lesson: "A2.11" },	{ front: "the construction sites", back: "die Baustellen", lesson: "A2.11" },
{ front: "the lane, the track", back: "die Spuren", lesson: "A2.11" },	{ front: "the lanes, the tracks", back: "die Spuren", lesson: "A2.11" },
{ front: "to overtake", back: "hat überholt", lesson: "A2.11" },	{ front: "has overtaken", back: "hat überholt", lesson: "A2.11" },
{ front: "the roadway", back: "die Fahrbahnen", lesson: "A2.11" },	{ front: "the roadways", back: "die Fahrbahnen", lesson: "A2.11" },
{ front: "careful, cautious", back: "-", lesson: "A2.11" },	
{ front: "because of, due to", back: "-", lesson: "A2.11" },	
{ front: "the ice", back: "-", lesson: "A2.11" },	
{ front: "the fog", back: "die Nebel", lesson: "A2.11" },	{ front: "the fogs", back: "die Nebel", lesson: "A2.11" },
{ front: "the storm", back: "die Stürme", lesson: "A2.11" },	{ front: "the storms", back: "die Stürme", lesson: "A2.11" },
{ front: "the thunderstorm", back: "die Gewitter", lesson: "A2.11" },	{ front: "the thunderstorms", back: "die Gewitter", lesson: "A2.11" },
{ front: "foggy", back: "-", lesson: "A2.11" },	
{ front: "the chaos", back: "-", lesson: "A2.11" },	
{ front: "to worry, to care for", back: "hat gesorgt", lesson: "A2.11" },	{ front: "has worried, has cared for", back: "hat gesorgt", lesson: "A2.11" },
{ front: "the situation", back: "die Situationen", lesson: "A2.11" },	{ front: "the situations", back: "die Situationen", lesson: "A2.11" },
{ front: "complete", back: "-", lesson: "A2.11" },	
{ front: "for hours", back: "-", lesson: "A2.11" },	
{ front: "the car", back: "die Wagen", lesson: "A2.11" },	{ front: "the cars", back: "die Wagen", lesson: "A2.11" },
{ front: "the region", back: "die Regionen", lesson: "A2.11" },	{ front: "the regions", back: "die Regionen", lesson: "A2.11" },
{ front: "the heat", back: "-", lesson: "A2.11" },	
{ front: "the part", back: "die Teile", lesson: "A2.11" },	{ front: "the parts", back: "die Teile", lesson: "A2.11" },
{ front: "strong, vigorous", back: "-", lesson: "A2.11" },	
{ front: "to avoid", back: "hat vermieden", lesson: "A2.11" },	{ front: "has avoided", back: "hat vermieden", lesson: "A2.11" },
{ front: "the danger", back: "die Gefahren", lesson: "A2.11" },	{ front: "the dangers", back: "die Gefahren", lesson: "A2.11" },
{ front: "the citizen", back: "die Bürger", lesson: "A2.11" },	{ front: "the citizens", back: "die Bürger", lesson: "A2.11" },
{ front: "the female citizen", back: "die Bürgerinnen", lesson: "A2.11" },	{ front: "the female citizens", back: "die Bürgerinnen", lesson: "A2.11" },
{ front: "the view", back: "die Aussichten", lesson: "A2.11" },	{ front: "the views", back: "die Aussichten", lesson: "A2.11" },
{ front: "to promise", back: "hat versprochen", lesson: "A2.11" },	{ front: "has promised", back: "hat versprochen", lesson: "A2.11" },
{ front: "summery, hot", back: "-", lesson: "A2.11" },	
{ front: "dense, close, tight", back: "-", lesson: "A2.11" },	
{ front: "to prevent", back: "hat verhindert", lesson: "A2.11" },	{ front: "has prevented", back: "hat verhindert", lesson: "A2.11" },
{ front: "the start", back: "die Starts", lesson: "A2.11" },	{ front: "the starts", back: "die Starts", lesson: "A2.11" },
{ front: "the landing", back: "die Landungen", lesson: "A2.11" },	{ front: "the landings", back: "die Landungen", lesson: "A2.11" },
{ front: "the airport", back: "die Flughäfen", lesson: "A2.11" },	{ front: "the airports", back: "die Flughäfen", lesson: "A2.11" },
{ front: "to start, to take off", back: "ist gestartet", lesson: "A2.11" },	{ front: "has started, has taken off", back: "ist gestartet", lesson: "A2.11" },
{ front: "to land", back: "ist gelandet", lesson: "A2.11" },	{ front: "has landed", back: "ist gelandet", lesson: "A2.11" },
{ front: "expected, likely", back: "-", lesson: "A2.11" },	
{ front: "the departure", back: "die Abflüge", lesson: "A2.11" },	{ front: "the departures", back: "die Abflüge", lesson: "A2.11" },
{ front: "dangerous", back: "-", lesson: "A2.11" },	
{ front: "to stand out, to be noticeable", back: "ist aufgefallen", lesson: "A2.11" },	{ front: "has stood out, has been noticeable", back: "ist aufgefallen", lesson: "A2.11" },
{ front: "the moped", back: "die Mopeds", lesson: "A2.11" },	{ front: "the mopeds", back: "die Mopeds", lesson: "A2.11" },
{ front: "the means of transport", back: "die Verkehrsmittel", lesson: "A2.11" },	{ front: "the means of transport", back: "die Verkehrsmittel", lesson: "A2.11" },
{ front: "to honk, to beep", back: "hat gehupt", lesson: "A2.11" },	{ front: "has honked, has beeped", back: "hat gehupt", lesson: "A2.11" },
{ front: "to brake", back: "hat gebremst", lesson: "A2.11" },	{ front: "has braked", back: "hat gebremst", lesson: "A2.11" },
{ front: "the pedestrian", back: "die Fußgänger", lesson: "A2.11" },	{ front: "the pedestrians", back: "die Fußgänger", lesson: "A2.11" },
{ front: "the female pedestrian", back: "die Fußgängerinnen", lesson: "A2.11" },	{ front: "the female pedestrians", back: "die Fußgängerinnen", lesson: "A2.11" },
{ front: "the fine, the ticket", back: "die Strafzettel", lesson: "A2.11" },	{ front: "the fines, the tickets", back: "die Strafzettel", lesson: "A2.11" },
{ front: "the penalty, the punishment", back: "die Strafen", lesson: "A2.11" },	{ front: "the penalties, the punishments", back: "die Strafen", lesson: "A2.11" },
{ front: "exhausting, strenuous", back: "-", lesson: "A2.11" },	
{ front: "terrible, awful", back: "-", lesson: "A2.11" },	
{ front: "public", back: "-", lesson: "A2.11" },	
{ front: "to talk, to speak", back: "hat geredet", lesson: "A2.11" },	{ front: "has talked, has spoken", back: "hat geredet", lesson: "A2.11" },
{ front: "the difference", back: "die Unterschiede", lesson: "A2.11" },	{ front: "the differences", back: "die Unterschiede", lesson: "A2.11" },
{ front: "the country", back: "-", lesson: "A2.11" },	
{ front: "the speed, the pace", back: "-", lesson: "A2.11" },	
{ front: "Балтийское море", back: "-", lesson: "A2.12" },	
{ front: "выбор", back: "-", lesson: "A2.12" },	
{ front: "осматривать", back: "hat besichtigt", lesson: "A2.12" },	{ front: "осмотрел", back: "hat besichtigt", lesson: "A2.12" },
{ front: "против", back: "-", lesson: "A2.12" },	
{ front: "восхищённый", back: "-", lesson: "A2.12" },	
{ front: "жильё", back: "die Unterkünfte", lesson: "A2.12" },	{ front: "жильё (мн. ч.)", back: "die Unterkünfte", lesson: "A2.12" },
{ front: "мечта", back: "die Träume", lesson: "A2.12" },	{ front: "мечты", back: "die Träume", lesson: "A2.12" },
{ front: "побережье", back: "die Küsten", lesson: "A2.12" },	{ front: "побережья", back: "die Küsten", lesson: "A2.12" },
{ front: "остров", back: "die Inseln", lesson: "A2.12" },	{ front: "острова", back: "die Inseln", lesson: "A2.12" },
{ front: "горы", back: "-", lesson: "A2.12" },	
{ front: "Люксембург", back: "-", lesson: "A2.12" },	
{ front: "купаться", back: "hat gebadet", lesson: "A2.12" },	{ front: "купался", back: "hat gebadet", lesson: "A2.12" },
{ front: "песок", back: "-", lesson: "A2.12" },	
{ front: "дальше", back: "-", lesson: "A2.12" },	
{ front: "прохладный", back: "-", lesson: "A2.12" },	
{ front: "ферма", back: "die Bauernhöfe", lesson: "A2.12" },	{ front: "фермы", back: "die Bauernhöfe", lesson: "A2.12" },
{ front: "корова", back: "die Kühe", lesson: "A2.12" },	{ front: "коровы", back: "die Kühe", lesson: "A2.12" },
{ front: "лошадь", back: "die Pferde", lesson: "A2.12" },	{ front: "лошади", back: "die Pferde", lesson: "A2.12" },
{ front: "овца", back: "die Schafe", lesson: "A2.12" },	{ front: "овцы", back: "die Schafe", lesson: "A2.12" },
{ front: "лодка", back: "die Boote", lesson: "A2.12" },	{ front: "лодки", back: "die Boote", lesson: "A2.12" },
{ front: "фестиваль", back: "die Festivals", lesson: "A2.12" },	{ front: "фестивали", back: "die Festivals", lesson: "A2.12" },
{ front: "достопримечательность", back: "die Sehenswürdigkeiten", lesson: "A2.12" },	{ front: "достопримечательности", back: "die Sehenswürdigkeiten", lesson: "A2.12" },
{ front: "прежде всего", back: "-", lesson: "A2.12" },	
{ front: "настоящий", back: "-", lesson: "A2.12" },	
{ front: "пансион", back: "die Pensionen", lesson: "A2.12" },	{ front: "пансионы", back: "die Pensionen", lesson: "A2.12" },
{ front: "взгляд", back: "die Blicke", lesson: "A2.12" },	{ front: "взгляды", back: "die Blicke", lesson: "A2.12" },
{ front: "одноместный номер", back: "-", lesson: "A2.12" },	
{ front: "двухместный номер", back: "-", lesson: "A2.12" },	
{ front: "туалет", back: "die WCs", lesson: "A2.12" },	{ front: "туалеты", back: "die WCs", lesson: "A2.12" },
{ front: "полупансион", back: "-", lesson: "A2.12" },	
{ front: "кемпинг", back: "-", lesson: "A2.12" },	
{ front: "тур", back: "die Touren", lesson: "A2.12" },	{ front: "туры", back: "die Touren", lesson: "A2.12" },
{ front: "долина", back: "die Täler", lesson: "A2.12" },	{ front: "долины", back: "die Täler", lesson: "A2.12" },
{ front: "луг", back: "die Wiesen", lesson: "A2.12" },	{ front: "луга", back: "die Wiesen", lesson: "A2.12" },
{ front: "романтичный", back: "-", lesson: "A2.12" },	
{ front: "расположение", back: "die Lagen", lesson: "A2.12" },	{ front: "расположения", back: "die Lagen", lesson: "A2.12" },
{ front: "замок", back: "die Schlösser", lesson: "A2.12" },	{ front: "замки", back: "die Schlösser", lesson: "A2.12" },
{ front: "исторический", back: "-", lesson: "A2.12" },	
{ front: "многочисленный", back: "-", lesson: "A2.12" },	
{ front: "ночлег", back: "die Übernachtungen", lesson: "A2.12" },	{ front: "ночлеги", back: "die Übernachtungen", lesson: "A2.12" },
{ front: "знаменитый", back: "-", lesson: "A2.12" },	
{ front: "собор", back: "die Dome", lesson: "A2.12" },	{ front: "соборы", back: "die Dome", lesson: "A2.12" },
{ front: "молодежная гостиница", back: "die Jugendherbergen", lesson: "A2.12" },	{ front: "молодежные гостиницы", back: "die Jugendherbergen", lesson: "A2.12" },
{ front: "включая", back: "-", lesson: "A2.12" },	
{ front: "пребывание", back: "die Aufenthalte", lesson: "A2.12" },	{ front: "пребывания", back: "die Aufenthalte", lesson: "A2.12" },
{ front: "бронировать", back: "hat gebucht", lesson: "A2.12" },	{ front: "забронировал", back: "hat gebucht", lesson: "A2.12" },
{ front: "туристическое агентство", back: "die Reisebüros", lesson: "A2.12" },	{ front: "туристические агентства", back: "die Reisebüros", lesson: "A2.12" },
{ front: "специалист", back: "die Spezialisten", lesson: "A2.12" },	{ front: "специалисты", back: "die Spezialisten", lesson: "A2.12" },
{ front: "сотрудник", back: "die Angestellten", lesson: "A2.12" },	{ front: "сотрудники", back: "die Angestellten", lesson: "A2.12" },
{ front: "сотрудница", back: "die Angestellten", lesson: "A2.12" },	{ front: "сотрудницы", back: "die Angestellten", lesson: "A2.12" },
{ front: "связь", back: "die Verbindungen", lesson: "A2.12" },	{ front: "связи", back: "die Verbindungen", lesson: "A2.12" },
{ front: "конечно", back: "-", lesson: "A2.12" },	
{ front: "серфить", back: "ist gesurft", lesson: "A2.12" },	{ front: "серфил", back: "ist gesurft", lesson: "A2.12" },
{ front: "экскурсия", back: "die Führungen", lesson: "A2.12" },	{ front: "экскурсии", back: "die Führungen", lesson: "A2.12" },
{ front: "старый город", back: "die Altstädte", lesson: "A2.12" },	{ front: "старые города", back: "die Altstädte", lesson: "A2.12" },
{ front: "выставка", back: "die Ausstellungen", lesson: "A2.12" },	{ front: "выставки", back: "die Ausstellungen", lesson: "A2.12" },
{ front: "известный", back: "-", lesson: "A2.12" },	
{ front: "нигде", back: "-", lesson: "A2.12" },	
{ front: "паковать", back: "hat eingepackt", lesson: "A2.12" },	{ front: "упаковал", back: "hat eingepackt", lesson: "A2.12" },
{ front: "договориться", back: "hat geeinigt", lesson: "A2.12" },	{ front: "договорился", back: "hat geeinigt", lesson: "A2.12" },
{ front: "ночевать", back: "hat übernachtet", lesson: "A2.12" },	{ front: "ночевал", back: "hat übernachtet", lesson: "A2.12" },
{ front: "быть против", back: "ist dagegen gewesen", lesson: "A2.12" },	{ front: "был против", back: "ist dagegen gewesen", lesson: "A2.12" },
{ front: "быть за", back: "ist dafür gewesen", lesson: "A2.12" },	{ front: "был за", back: "ist dafür gewesen", lesson: "A2.12" },
{ front: "принимать", back: "hat angenommen", lesson: "A2.12" },	{ front: "принял", back: "hat angenommen", lesson: "A2.12" },
{ front: "отклонять", back: "hat abgelehnt", lesson: "A2.12" },	{ front: "отклонил", back: "hat abgelehnt", lesson: "A2.12" },
{ front: "лениться", back: "hat gefaulenzt", lesson: "A2.12" },	{ front: "ленился", back: "hat gefaulenzt", lesson: "A2.12" },
{ front: "туристическая цель", back: "die Reiseziele", lesson: "A2.12" },	{ front: "туристические цели", back: "die Reiseziele", lesson: "A2.12" },
{ front: "горы", back: "-", lesson: "A2.12" },	
{ front: "остров", back: "die Inseln", lesson: "A2.12" },	{ front: "острова", back: "die Inseln", lesson: "A2.12" },
{ front: "побережье", back: "die Küsten", lesson: "A2.12" },	{ front: "побережья", back: "die Küsten", lesson: "A2.12" },
{ front: "занятия", back: "-", lesson: "A2.12" },	
{ front: "осматривать достопримечательности", back: "hat Sehenswürdigkeiten angesehen", lesson: "A2.12" },	{ front: "осмотрел достопримечательности", back: "hat Sehenswürdigkeiten angesehen", lesson: "A2.12" },
{ front: "осматривать старый город", back: "hat die Altstadt besichtigt", lesson: "A2.12" },	{ front: "осмотрел старый город", back: "hat die Altstadt besichtigt", lesson: "A2.12" },
{ front: "смотреть выставку", back: "hat eine Ausstellung angesehen", lesson: "A2.12" },	{ front: "посмотрел выставку", back: "hat eine Ausstellung angesehen", lesson: "A2.12" },
{ front: "делать экскурсию по городу", back: "hat eine Stadtführung gemacht", lesson: "A2.12" },	{ front: "сделал экскурсию по городу", back: "hat eine Stadtführung gemacht", lesson: "A2.12" },
{ front: "жильё", back: "die Unterkünfte", lesson: "A2.12" },	{ front: "жильё (мн. ч.)", back: "die Unterkünfte", lesson: "A2.12" },
{ front: "кемпинг", back: "-", lesson: "A2.12" },	
{ front: "ферма", back: "die Bauernhöfe", lesson: "A2.12" },	{ front: "фермы", back: "die Bauernhöfe", lesson: "A2.12" },
{ front: "одноместный номер", back: "-", lesson: "A2.12" },	
{ front: "двухместный номер", back: "-", lesson: "A2.12" },	
{ front: "пансион", back: "die Pensionen", lesson: "A2.12" },	{ front: "пансионы", back: "die Pensionen", lesson: "A2.12" },
{ front: "молодежная гостиница", back: "die Jugendherbergen", lesson: "A2.12" },	{ front: "молодежные гостиницы", back: "die Jugendherbergen", lesson: "A2.12" },
{ front: "в туристическом агентстве", back: "-", lesson: "A2.12" },	
{ front: "бронировать поездку", back: "hat eine Reise gebucht", lesson: "A2.12" },	{ front: "забронировал поездку", back: "hat eine Reise gebucht", lesson: "A2.12" },
{ front: "справка", back: "-", lesson: "A2.12" },	
{ front: "путешествие", back: "die Reisen", lesson: "A2.12" },	{ front: "путешествия", back: "die Reisen", lesson: "A2.12" },
{ front: "офис", back: "die Büros", lesson: "A2.12" },	{ front: "офисы", back: "die Büros", lesson: "A2.12" },
{ front: "лёд", back: "-", lesson: "A2.12" },	
{ front: "яйцо", back: "die Eier", lesson: "A2.12" },	{ front: "яйца", back: "die Eier", lesson: "A2.12" },
{ front: "сумма", back: "die Beträge", lesson: "A2.12" },	{ front: "суммы", back: "die Beträge", lesson: "A2.12" },
{ front: "счёт", back: "die Konten", lesson: "A2.13" },	{ front: "счёта", back: "die Konten", lesson: "A2.13" },
{ front: "открывать", back: "hat eröffnet", lesson: "A2.13" },	{ front: "открыл", back: "hat eröffnet", lesson: "A2.13" },
{ front: "отвечать", back: "hat beantwortet", lesson: "A2.13" },	{ front: "ответил", back: "hat beantwortet", lesson: "A2.13" },
{ front: "достать, приобрести", back: "hat besorgt", lesson: "A2.13" },	{ front: "достал", back: "hat besorgt", lesson: "A2.13" },
{ front: "откладывать", back: "hat verschoben", lesson: "A2.13" },	{ front: "отложил", back: "hat verschoben", lesson: "A2.13" },
{ front: "банковская карта", back: "die EC-Karten", lesson: "A2.13" },	{ front: "банковские карты", back: "die EC-Karten", lesson: "A2.13" },
{ front: "снимать (деньги)", back: "hat abgehoben", lesson: "A2.13" },	{ front: "снял", back: "hat abgehoben", lesson: "A2.13" },
{ front: "получать", back: "hat gekriegt", lesson: "A2.13" },	{ front: "получил", back: "hat gekriegt", lesson: "A2.13" },
{ front: "банкомат", back: "die Geldautomaten", lesson: "A2.13" },	{ front: "банкоматы", back: "die Geldautomaten", lesson: "A2.13" },
{ front: "расчётный счёт", back: "die Girokonten", lesson: "A2.13" },	{ front: "расчётные счёта", back: "die Girokonten", lesson: "A2.13" },
{ front: "ли", back: "-", lesson: "A2.13" },	
{ front: "наличные деньги", back: "-", lesson: "A2.13" },	
{ front: "сумма", back: "die Summen", lesson: "A2.13" },	{ front: "суммы", back: "die Summen", lesson: "A2.13" },
{ front: "но (после отрицания)", back: "-", lesson: "A2.13" },	
{ front: "ежемесячный", back: "-", lesson: "A2.13" },	
{ front: "проценты", back: "-", lesson: "A2.13" },	
{ front: "принимать", back: "hat akzeptiert", lesson: "A2.13" },	{ front: "принял", back: "hat akzeptiert", lesson: "A2.13" },
{ front: "карманные деньги", back: "-", lesson: "A2.13" },	
{ front: "выполнять, завершать", back: "hat erledigt", lesson: "A2.13" },	{ front: "выполнил", back: "hat erledigt", lesson: "A2.13" },
{ front: "контролировать", back: "hat kontrolliert", lesson: "A2.13" },	{ front: "контролировал", back: "hat kontrolliert", lesson: "A2.13" },
{ front: "контроль", back: "die Kontrollen", lesson: "A2.13" },	{ front: "контроли", back: "die Kontrollen", lesson: "A2.13" },
{ front: "ломаться", back: "ist kaputtgegangen", lesson: "A2.13" },	{ front: "сломался", back: "ist kaputtgegangen", lesson: "A2.13" },
{ front: "узнавать", back: "hat erkannt", lesson: "A2.13" },	{ front: "узнал", back: "hat erkannt", lesson: "A2.13" },
{ front: "производитель", back: "die Hersteller", lesson: "A2.13" },	{ front: "производители", back: "die Hersteller", lesson: "A2.13" },
{ front: "масло", back: "-", lesson: "A2.13" },	
{ front: "тормоз", back: "die Bremsen", lesson: "A2.13" },	{ front: "тормоза", back: "die Bremsen", lesson: "A2.13" },
{ front: "проверять", back: "hat überprüft", lesson: "A2.13" },	{ front: "проверил", back: "hat überprüft", lesson: "A2.13" },
{ front: "ремонтировать", back: "hat renoviert", lesson: "A2.13" },	{ front: "отремонтировал", back: "hat renoviert", lesson: "A2.13" },
{ front: "изменять", back: "hat geändert", lesson: "A2.13" },	{ front: "изменил", back: "hat geändert", lesson: "A2.13" },
{ front: "порезаться", back: "hat geschnitten", lesson: "A2.13" },	{ front: "порезался", back: "hat geschnitten", lesson: "A2.13" },
{ front: "вносить деньги", back: "hat eingezahlt", lesson: "A2.13" },	{ front: "внес деньги", back: "hat eingezahlt", lesson: "A2.13" },
{ front: "брошюра", back: "die Broschüren", lesson: "A2.13" },	{ front: "брошюры", back: "die Broschüren", lesson: "A2.13" },
{ front: "зарплата", back: "die Gehälter", lesson: "A2.13" },	{ front: "зарплаты", back: "die Gehälter", lesson: "A2.13" },
{ front: "справка о зарплате", back: "die Gehaltsnachweise", lesson: "A2.13" },	{ front: "справки о зарплате", back: "die Gehaltsnachweise", lesson: "A2.13" },
{ front: "набирать (текст)", back: "hat getippt", lesson: "A2.13" },	{ front: "набрал", back: "hat getippt", lesson: "A2.13" },
{ front: "переводить (деньги)", back: "hat überwiesen", lesson: "A2.13" },	{ front: "перевёл", back: "hat überwiesen", lesson: "A2.13" },
{ front: "меню", back: "die Menüs", lesson: "A2.13" },	{ front: "меню (мн. ч.)", back: "die Menüs", lesson: "A2.13" },
{ front: "официант", back: "die Ober", lesson: "A2.13" },	{ front: "официанты", back: "die Ober", lesson: "A2.13" },
{ front: "полиция", back: "-", lesson: "A2.13" },	
{ front: "злой", back: "-", lesson: "A2.13" },	
{ front: "настроение", back: "die Launen", lesson: "A2.13" },	{ front: "настроения", back: "die Launen", lesson: "A2.13" },
{ front: "повышение", back: "die Erhöhungen", lesson: "A2.13" },	{ front: "повышения", back: "die Erhöhungen", lesson: "A2.13" },
{ front: "выписка со счёта", back: "die Kontoauszüge", lesson: "A2.13" },	{ front: "выписки со счёта", back: "die Kontoauszüge", lesson: "A2.13" },
{ front: "снимать деньги", back: "hat abgehoben", lesson: "A2.13" },	{ front: "снял деньги", back: "hat abgehoben", lesson: "A2.13" }
];



const roundConfiguration = [
  { round: 0, type: "multiple choice", delay_days: 0 }, // ← prep round
  { round: 1, type: "typing", delay_days: 0 },
  { round: 2, type: "typing", delay_days: 1 },
  { round: 3, type: "typing", delay_days: 3 },
  { round: 4, type: "typing", delay_days: 7 },
  { round: 5, type: "typing", delay_days: 14 },
  { round: 6, type: "typing", delay_days: 30 },
  { round: 7, type: "typing", delay_days: 90 }
];


// Add status and round flags

let currentCardIndex = 0;
const cardToDotMap = {};

const cardContainer = document.getElementById("card-container");
const optionsContainer = document.getElementById("options-container");
const nextBtn = document.getElementById("next-btn");
const progressBar = document.getElementById("progress-bar");

let batchIndex = 0;
let batches = [];
const BATCH_SIZE = 25;



function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function getRandomOptions(correct, allOptions, count = 3) {
  // Filter for current lesson
  const lessonOptions = allOptions.filter(opt => opt.lesson === correct.lesson);
  let pool = lessonOptions.length >= (count + 1) ? lessonOptions : allOptions;

  const others = pool
    .filter(opt => opt.back !== correct.back)
    .sort(() => Math.random() - 0.5)
    .slice(0, count);

  return shuffle([...others, correct]);
}

function initProgressBar() {
  progressBar.innerHTML = "";
  cards.forEach((card, index) => {
    const dot = document.createElement("div");
    dot.classList.add("progress-segment");
    if (index === 0) dot.classList.add("active");
    dot.setAttribute("data-back", card.back);
    progressBar.appendChild(dot);
    cardToDotMap[card.back] = dot;
  });
}


function updateActiveDot(card) {
  document.querySelectorAll(".progress-segment").forEach(dot => {
    dot.classList.remove("active");
  });

  const dot = cardToDotMap[card.back];
  if (dot) {
    dot.classList.add("active");
  }
}



function reorderProgressBar() {
  cards.forEach(card => {
    const dot = cardToDotMap[card.back];
    if (dot) {
      progressBar.appendChild(dot);
    }
  });

  // ✅ Update active dot based on currently visible card
  if (cards[currentCardIndex]) {
    updateActiveDot(cards[currentCardIndex]);
  }
}

 function getPromotedRound(currentRound, lastSeenDate) {
  const now = new Date();
  const daysElapsed = Math.floor((now - new Date(lastSeenDate)) / (1000 * 60 * 60 * 24));

  // Find the highest round where delay_days <= daysElapsed
  let newRound = currentRound;
  for (let i = currentRound + 1; i <= roundConfiguration.length; i++) {
    const cfg = roundConfiguration.find(r => r.round === i);
    if (cfg && cfg.delay_days <= daysElapsed) {
      newRound = i;
    } else {
      break;
    }
  }
  return newRound;
}

function updateDotColor(card) {
  const dot = cardToDotMap[card.back];
  if (!dot) return;

  dot.classList.remove("correct", "incorrect", "multiple");

  if (card.status === "typed-correct") {
    dot.classList.add("correct"); // green = typed correct
  } else if (card.status === "multiple-correct") {
    dot.classList.add("multiple"); // yellow = multiple choice correct
  } else if (card.status === "incorrect") {
    dot.classList.add("incorrect"); // red = incorrect
  }
}

function renderCard(card) {
  cardContainer.textContent = card.front;
  optionsContainer.innerHTML = "";
  

 const roundCfg = roundConfiguration.find(cfg => cfg.round === card.round);
const isTypingRound = roundCfg && roundCfg.type === "typing";


  if (!isTypingRound) {
  // MULTIPLE CHOICE ROUND
  const options = getRandomOptions(card, vocabulary);
  optionsContainer.setAttribute('round', 'multiple-choice');
  
  let hasMadeMistake = false;

  options.forEach(option => {
    const input = document.createElement("input");
    const label = document.createElement("label");

    const id = `cb-${Math.random()}`;
    input.type = "checkbox";
    input.id = id;
    label.htmlFor = id;
    label.textContent = option.back;

    input.onclick = () => {
  const isCorrect = option.back === card.back;

  if (input.disabled) return; // prevent any further clicks on this option

  input.disabled = true; // disable only this one after click

if (isCorrect) {
  if (!hasMadeMistake) {
    card.status = "multiple-correct";

    if (card.round < roundConfiguration.length) {
      card.round = 1;
    }

    card.lastSeen = new Date().toISOString();

    cardRound[card.back] = {
      round: card.round,
      lastSeen: card.lastSeen
    };
    saveCardRound(cardRound);

    setTimeout(() => {
      cards.push(card); // reinsert at end
      reorderProgressBar();
    }, 300);
  } else {
    // ❌ User clicked correct after a wrong — do not update round or save
    card.status = "incorrect";
    setTimeout(() => {
      const insertAt = Math.min(currentCardIndex + 4, cards.length);
      cards.splice(insertAt, 0, card);
      reorderProgressBar();
    }, 300);
  }

  updateDotColor(card);
  input.classList.add("right");
  nextBtn.disabled = false;
} else {
  hasMadeMistake = true;
  card.status = "incorrect";
  updateDotColor(card);
  input.classList.add("wrong");
}

};


    optionsContainer.append(input, label);
  });
}
 else {
// TYPING ROUND
  if (typeof card.madeMistakeThisSession === "undefined") {
    card.madeMistakeThisSession = false;
  }
const input = document.createElement("input");
optionsContainer.setAttribute('round', 'typing');
input.type = "text";
input.placeholder = "Type the answer...";
input.className = "typing-input";

const checkBtn = document.createElement("button");
checkBtn.textContent = "Check";
checkBtn.className = "check-btn";
    
function normalizeInputLenient(str) {
  // for counting real mistakes (ignore accents)
  return str
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // remove accents
    .replace(/[’‘]/g, "'")
    .replace(/["“”]/g, '"')
    .toLowerCase()
    .trim();
}

function normalizeInputStrict(str) {
  // for feedback & display — keep accents
  return str
    .replace(/[’‘]/g, "'")
    .replace(/["“”]/g, '"')
    .toLowerCase()
    .trim();
}

function levenshtein(a, b) {
  const matrix = Array.from({ length: a.length + 1 }, (_, i) =>
    Array.from({ length: b.length + 1 }, (_, j) =>
      i === 0 ? j : j === 0 ? i : 0
    )
  );

  for (let i = 1; i <= a.length; i++) {
    for (let j = 1; j <= b.length; j++) {
      if (a[i - 1] === b[j - 1]) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = 1 + Math.min(
          matrix[i - 1][j],     // deletion
          matrix[i][j - 1],     // insertion
          matrix[i - 1][j - 1]  // substitution
        );
      }
    }
  }

  return matrix[a.length][b.length];
}

function normalizeQuotes(str) {
  return str
    .replace(/[’‘]/g, "'")
    .replace(/["“”]/g, '"')
    .toLowerCase()
    .trim();
}

function checkAnswer() {
  const userAnswer = input.value;
  const correctAnswer = card.back;

const normalizedUserLenient = normalizeInputLenient(userAnswer);
  const normalizedCorrectLenient = normalizeInputLenient(correctAnswer);

  const normalizedUserStrict = normalizeInputStrict(userAnswer);
  const normalizedCorrectStrict = normalizeInputStrict(correctAnswer);

  const distanceLenient = levenshtein(normalizedUserLenient, normalizedCorrectLenient);
  const distanceStrict = levenshtein(normalizedUserStrict, normalizedCorrectStrict);

  const isPerfect = distanceStrict === 0;
  const isCloseEnough = distanceLenient <= 2;

  const isRealMistake = distanceLenient > 2; // ← ignores accent issues


  const isCorrect = isPerfect || isCloseEnough;

  if (isCorrect) {
    if (!card.madeMistakeThisSession && isRealMistake) {
      card.madeMistakeThisSession = true; // only count real spelling/word errors
    }

    if (!card.madeMistakeThisSession) {
      if (card.round==1) {
        card.round = Math.min(card.round + 1, roundConfiguration.length);
        console.log("update round 295");
        
      } 
      else {
        card.round = getPromotedRound(card.round, card.lastSeen);
        console.log("update round 299");
      }
    }



    card.lastSeen = new Date().toISOString();

    cardRound[card.back] = {
      round: card.round,
      lastSeen: card.lastSeen
    };
    saveCardRound(cardRound);

    card.status = "typed-correct";
    checkBtn.classList.add("right");
    checkBtn.classList.add("checked");
    updateDotColor(card);

    if (!isPerfect) {
      const feedback = document.createElement("div");
      feedback.className = "feedback";
      feedback.textContent = `Close enough! Correct: ${card.back}`;
      optionsContainer.appendChild(feedback);
    }

  } else {
    card.status = "incorrect";
    card.madeMistakeThisSession = true;

    checkBtn.classList.add("wrong");
    checkBtn.classList.add("checked");
    updateDotColor(card);

    const feedback = document.createElement("div");
    feedback.className = "feedback";
    feedback.textContent = `Correct answer: ${card.back}`;
    optionsContainer.appendChild(feedback);

    setTimeout(() => {
      cards.splice(currentCardIndex + 4, 0, card);
      reorderProgressBar();
    }, 300);
  }

  input.disabled = true;
  checkBtn.disabled = true;
  nextBtn.disabled = false;
}


checkBtn.onclick = checkAnswer;

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !checkBtn.disabled) {
    checkAnswer();
  }
});

optionsContainer.appendChild(input);
optionsContainer.appendChild(checkBtn);
input.focus();

  }
}

function loadBatch(index) {
  cards = batches[index] || [];
  currentCardIndex = 0;
  Object.keys(cardToDotMap).forEach(key => delete cardToDotMap[key]);
  initProgressBar();
  if (cards.length > 0) {
    showNextCard();
    nextBtn.style.display = "";
  } else {
    cardContainer.textContent = "No cards due!";
    optionsContainer.innerHTML = "";
    nextBtn.style.display = "none";
  }
}

function showNextCard() {
  if (currentCardIndex >= cards.length) {
         // Batch complete
    cardContainer.textContent = batchIndex === batches.length - 1
      ? "Session complete!"
      : "You have completed the first batch.";
    optionsContainer.innerHTML = "";
    
    // Show continue button if more batches remain
    if (batchIndex < batches.length - 1) {
      let continueBtn = document.createElement("button");
      continueBtn.textContent = "Continue";
      continueBtn.className = "continue-btn";
      continueBtn.onclick = function() {
        batchIndex++;
        loadBatch(batchIndex);
        nextBtn.style.display = "";
      };
      optionsContainer.appendChild(continueBtn);
      nextBtn.style.display = "none";
    } else {
      nextBtn.style.display = "none";
    }
    return;
  }

  const currentCard = cards[currentCardIndex];
  renderCard(currentCard);
  updateActiveDot(currentCard);
  reorderProgressBar();
  nextBtn.disabled = true;
  currentCardIndex++;
}

nextBtn.addEventListener("click", showNextCard);




//////////////////////////////////// save card round to local storage ///////////////
let db;

function openDatabase() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open("FlashcardsDB", 1);

    request.onupgradeneeded = function (event) {
      db = event.target.result;
      if (!db.objectStoreNames.contains("CardRounds")) {
        db.createObjectStore("CardRounds", { keyPath: "back" });
      }
    };

    request.onsuccess = function (event) {
      db = event.target.result;
      resolve();
    };

    request.onerror = function () {
      reject("Failed to open IndexedDB");
    };
  });
}



function loadCardRound() {
  return new Promise((resolve, reject) => {
    if (!db) return resolve({});

    const tx = db.transaction("CardRounds", "readonly");
    const store = tx.objectStore("CardRounds");
    const request = store.getAll();

    request.onsuccess = function () {
      const result = {};
      request.result.forEach(entry => {
        result[entry.back] = {
          round: entry.round,
          lastSeen: entry.lastSeen
        };
      });
      console.log("474 return load", result);
      resolve(result);
    };

    request.onerror = function () {
      reject("Failed to load cardRound from IndexedDB");
    };
  });
}


function saveCardRound(roundObj) {
  if (!db) return;

  const tx = db.transaction("CardRounds", "readwrite");
  const store = tx.objectStore("CardRounds");

  for (const [back, data] of Object.entries(roundObj)) {
    store.put({ back, ...data });
  }

  tx.oncomplete = () => {
    console.log("Saved cardRound to IndexedDB");
  };

  tx.onerror = () => {
    console.error("Failed to save cardRound to IndexedDB");
  };
}


function isCardDue(card) {
  const roundCfg = roundConfiguration.find(r => r.round === card.round);
  if (!roundCfg) return true;

  // Round 0 & 1 cards are always due
  if (card.round === 0 || card.round === 1) return true;

  if (!card.lastSeen) return true; // If the card has never been answered, it's due

  const lastSeenDate = new Date(card.lastSeen);
  const now = new Date();
  const isSameDay = lastSeenDate.toDateString() === now.toDateString();

  // For round 2 or beyond, check if the card was answered today
  if (card.round >= 2 && isSameDay) {
    return false; // It shouldn't be due if it was answered today
  }

  const nextDueDate = new Date(lastSeenDate.getTime() + roundCfg.delay_days * 24 * 60 * 60 * 1000);
  return now >= nextDueDate;
}




let cardRound = {};

openDatabase().then(() => {
  return loadCardRound();
}).then((loaded) => {
  cardRound = loaded;

  // ⬇️ Now proceed to map cards and initialize your app
  let allCards = vocabulary.map(card => {
    const saved = cardRound[card.back] || {};
    return {
      ...card,
      round: saved.round ?? 0,
      lastSeen: saved.lastSeen || null,
      status: null
    };
  });

  // Filter & shuffle
  cards = shuffle(allCards.filter(isCardDue));

  loadBatch(batchIndex);
  showDashboard();
});


let allCards = vocabulary.map(card => {
  const saved = cardRound[card.back] || {};
  return {
    ...card,
    round: saved.round ?? 0,
    lastSeen: saved.lastSeen || null,
    status: null
  };
});

// ✅ Only keep cards that are due
//let cards = shuffle(allCards.filter(isCardDue));
let cards = shuffle(allCards.filter(card => {
  const due = isCardDue(card);
  if (!due) {
    console.log(`Skipping not-due card: ${card.back} | Round ${card.round} | Last seen ${card.lastSeen}`);
  }
  return due;
}));

async function loadVocabulary(lesson) {
  currentLesson = lesson;
  batchIndex = 0;
  // Load the saved card rounds from local storage
  const cardRound = await loadCardRound();

  // Map through vocabulary and assign round and lastSeen status
  let allCards = vocabulary
    .filter(card => card.lesson === lesson)
    .map(card => {
      const saved = cardRound[card.back] || {};
      return {
        ...card,
        round: saved.round ?? 0,
        lastSeen: saved.lastSeen || null,
        status: null
      };
    });

  // Filter out cards that are due for review yet
  let dueCards = shuffle(allCards.filter(card => {
    
    const due = isCardDue(card);
    if (!due) {
      console.log(`Skipping not-due card: ${card.back} | Round ${card.round} | Last seen ${card.lastSeen}`);
    }
    return due;
  }));

  // Split dueCards into batches of 25
  batches = [];
  for (let i = 0; i < dueCards.length; i += BATCH_SIZE) {
    batches.push(dueCards.slice(i, i + BATCH_SIZE));
  }

  loadBatch(batchIndex);

  showStudyMode();

    console.log("Vocabulary loaded and shuffled:", dueCards);
}

// Attach event listeners to study buttons
document.querySelectorAll('.study-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const lesson = this.getAttribute('data-lesson');
    loadVocabulary(lesson);
  });
});

async function updateLessonProgressBars() {
  // Get card round info from localStorage
  const cardRound = await loadCardRound();

  // For each lesson card
  document.querySelectorAll('.card[data-lesson]').forEach(cardEl => {
    const lesson = cardEl.getAttribute('data-lesson');
    // All vocab for this lesson
    const lessonVocab = vocabulary.filter(v => v.lesson === lesson);
    const total = lessonVocab.length;

    // For each round 1-7
    for (let round = 1; round <= 7; round++) {
      // Count how many words are at this round or higher
      const completed = lessonVocab.filter(v => {
        const saved = cardRound[v.back];
        return saved && (saved.round ?? 0) >= round;
      }).length;
      const percent = total > 0 ? Math.round((completed / total) * 100) : 0;

      // Find the progress bar for this round
      const track = cardEl.querySelector(`.progress-track[data-round="${round}"] .progress-fill`);
      if (track) {
        track.style.width = percent + "%";
      }
    }
  });
}

async function showDashboard() {
  document.querySelector('.dashboard').style.display = '';
  document.getElementById('study-mode').style.display = 'none';
  await updateLessonProgressBars();
}

function showStudyMode() {
  document.querySelector('.dashboard').style.display = 'none';
  document.getElementById('study-mode').style.display = '';
}

// Close study mode and return to dashboard
document.getElementById('close-study').addEventListener('click', function() {
  showDashboard();
  // Optionally clear study mode UI
  document.getElementById('card-container').textContent = '';
  document.getElementById('options-container').innerHTML = '';
  document.getElementById('progress-bar').innerHTML = '';
  document.getElementById('next-btn').disabled = true;
});

// On page load, show dashboard and hide study mode
showDashboard();
